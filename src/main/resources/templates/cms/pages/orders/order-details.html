<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <!-- Required Meta Tags Always Come First -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Title -->
    <title>LightBee | Order Details</title>
    <!-- Favicon -->
    <link rel="shortcut icon" href="favicon.ico">
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="/assets/cms/css/sweetalert2.min.css">

    <!-- CSS Implementing Plugins -->
    <link rel="stylesheet" href="/assets/cms/css/vendor.min.css">
    <link rel="stylesheet" href="/assets/cms/vendor/icon-set/style.css">
    <!-- CSS Front Template -->
    <link rel="stylesheet" href="/assets/cms/css/theme.min.css?v=1.0">
    <!-- CSS Timeline -->
    <link rel="stylesheet" href="/assets/cms/css/timeline.css">
    <style>
        .swal2-timer-progress-bar{
            background-color: #a5dc86;
        }
    </style>
</head>
<body class="   footer-offset">
<script src="/assets/cms/vendor/hs-navbar-vertical-aside/hs-navbar-vertical-aside-mini-cache.js"></script>

<!-- ========== HEADER ========== -->
<div th:replace="~{/cms/pages/_header.html}"></div>
<!-- ========== END HEADER ========== -->

<!-- ========== SIDEBAR ========== -->
<div th:replace="~{/cms/pages/_sidebar.html}"></div>
<!-- ========== END SIDEBAR ========== -->
<script src="/assets/cms/js/demo.js"></script>

<!-- ========== MAIN CONTENT ========== -->

<main id="content" role="main" class="main">
    <!-- Content -->
    <div class="content container-fluid">
        <!-- Page Header -->
        <div class="page-header d-print-none">
            <div class="row align-items-center">
                <div class="col-sm mb-2 mb-sm-0">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb breadcrumb-no-gutter">
                            <li class="breadcrumb-item"><a class="breadcrumb-link" th:href="@{/cms/hoa-don}">Hóa Đơn</a>
                            </li>
                            <li class="breadcrumb-item active" aria-current="page">Chi Tiết</li>
                        </ol>
                    </nav>

                    <div class="d-sm-flex align-items-sm-center">
                        <h1 id="id-for-attribute" th:attr="id-for-call-api=${hoaDon.id}" class="page-header-title" th:text="'Đơn Hàng #' + ${hoaDon.maHoaDon}"></h1>
                        <div class="trangThaiHeader ml-sm-3">
                            <span th:class="${hoaDon.trangThai.toString() == 'ThanhCong' ? 'badge badge-soft-success' :
                    (hoaDon.trangThai.toString() == 'ChoGiao' ? 'badge badge-soft-warning' : 'badge badge-soft-danger')}"
                                  th:text="'Trạng thái: ' + ${hoaDon.trangThai}">
                  <span class="legend-indicator bg-success"></span>
                </span>
                        </div>
                        <span class="badge badge-soft-success ml-2 ml-sm-3" th:text="'Ngày Tạo: ' + ${hoaDon.ngayTao}">
                  <i class="tio-date-range"></i>
                </span>
                    </div>

                    <div class="mt-2">
                        <a class="text-body mr-3" href="javascript:;" onclick="window.print(); return false;">
                            <i class="tio-print mr-1"></i> Print order
                        </a>
                    </div>
                </div>

                <div class="col-sm-auto">
                    <a class="btn btn-icon btn-sm btn-ghost-secondary rounded-circle mr-1" href="#"
                       data-toggle="tooltip" data-placement="top" title="Previous order">
                        <i class="tio-arrow-backward"></i>
                    </a>
                    <a class="btn btn-icon btn-sm btn-ghost-secondary rounded-circle" href="#" data-toggle="tooltip"
                       data-placement="top" title="Next order">
                        <i class="tio-arrow-forward"></i>
                    </a>
                </div>
            </div>
        </div>
        <!-- End Page Header -->

        <div class="row col-12" th:insert="~{/cms/pages/orders/_timeline.html}"></div>

        <div class="row mt-2 mb-2">
            <div th:attr="id-hoa-don=${hoaDon.id}" class="col-6 justify-content-start" id="myButton">
                <button th:if="${hoaDon.trangThai.toString() != 'Huy' && hoaDon.trangThai.toString() != 'ThanhCong'}"
                        class="btn btn-sm btn-outline-success mr-1" id="xacNhanFromDetail">
                    <i class="tio-checkmark-circle-outlined"></i> Xác Nhận
                </button>
                <button th:if="${hoaDon.trangThai.toString() == 'ChoXacNhan'}" id="getAttrToHuyFromDetail" type="button" class="btn btn-sm btn-outline-danger mr-1" data-toggle="modal" data-target="#modalCancelReasons">
                    <i class="tio-delete-outlined"></i> Hủy
                </button>
                <button class="btn btn-sm btn-outline-primary d-none"
                        id="hoanTacFromDetail">
                    <i class="tio-history"></i> Hoàn Tác
                </button>
            </div>
            <div class="col-6 d-flex justify-content-end">
                <button th:class="'btn btn-sm btn-outline-dark mr-1 ' + ${hoaDon.trangThai.toString() == 'ChoXacNhan' || hoaDon.trangThai.toString() == 'Huy' ? 'd-none' : ''}" id="printOrder">
                    <i class="tio-print"></i> In hóa đơn
                </button>
                <button class="btn btn-sm btn-outline-dark mr-1" data-toggle="modal" data-target="#history">
                    <i class="tio-timer"></i> Lịch Sử
                </button>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-8 mb-3 mb-lg-0">
                <!-- Card -->
                <div class="card mb-3 mb-lg-5">
                    <!-- Header -->
                    <div class="card-header">
                        <h4 class="card-header-title">Chi tiết đơn hàng <span
                                class="badge badge-soft-dark rounded-circle ml-1"
                                th:text="${hoaDonChiTietList.size()}"></span></h4>
                        <a class="link" href="javascript:;">Chỉnh sửa</a>
                    </div>
                    <!-- End Header -->

                    <!-- Body -->
                    <div class="card-body">
                        <!-- Media -->
                        <div class="media mb-1 product" th:each="hdct, productInfo : ${hoaDonChiTietList}" th:data-productId="${productInfo.index}">
                            <div class="avatar avatar-xl mr-3">
                                <img class="img-fluid" th:src="${hdct.chiTietSanPham.anh.url}" alt="Image Description">
                            </div>

                            <div class="media-body">
                                <div class="row">
                                    <div class="col-md-6 mb-3 mb-md-0">
                                        <a class="h5 d-block productName" th:href="@{|/cms/view-product?id=${hdct.chiTietSanPham.sanPham.id}|}"
                                           th:text="${hdct.chiTietSanPham.sanPham.ten}"></a>
                                        <div class="font-size-sm text-body">
                                            <span>Color:</span>
                                            <span class="font-weight-bold productColor"
                                                  th:text="${hdct.chiTietSanPham.mauSac.ten}"></span>
                                        </div>
                                        <div class="font-size-sm text-body">
                                            <span>Size:</span>
                                            <span class="font-weight-bold productSize"
                                                  th:text="${hdct.chiTietSanPham.kichCo.ten}"></span>
                                        </div>
                                    </div>

                                    <div class="col col-md-2 align-self-center">
                                        <h6 class="productPrice" th:text="${#numbers.formatInteger(hdct.chiTietSanPham.giaBan.intValue(), 0, 'COMMA')}"></h6>
                                    </div>

                                    <div class="col col-md-2 align-self-center">
                                        <h6 class="productQuantity" th:text="${hdct.getSoLuong()}"></h6>
                                    </div>

                                    <div class="col col-md-2 align-self-center text-right">
                                        <h6 th:text="${#numbers.formatInteger(hdct.chiTietSanPham.giaBan.intValue() * hdct.getSoLuong(), 0, 'COMMA')}"></h6>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- End Media -->
                        <hr>

                        <div class="row mb-3">
                            <div class="col-md-4 col-lg-5 justify-content-md-start">
                                <h5>Đơn vị vận chuyển</h5>
                                <img src="https://api.ghn.vn/themes/angulr/img/logo-ghn-new.png" alt="">
                            </div>
                            <div class="col-md-8 justify-content-md-end col-lg-7">
                                <dl class="row text-sm-right">
                                    <dt class="col-sm-6">Tổng tiền:</dt>
                                    <dd class="col-sm-6"
                                        th:text="${#numbers.formatInteger(tongTien.intValue(), 0, 'COMMA')}"></dd>
                                    <dt class="col-sm-6">Phí ship: </dt>
                                    <dd class="col-sm-6"
                                        th:text="${#numbers.formatInteger(hoaDon.phiShip.intValue(), 0, 'COMMA')}"></dd>
                                    <dt class="col-sm-6">Thực thu:</dt>
                                    <dd class="col-sm-6"
                                        th:text="${#numbers.formatInteger(hoaDon.phiShip.intValue() + tongTien, 0, 'COMMA')}"></dd>
                                </dl>
                                <!-- End Row -->
                            </div>
                        </div>
                        <!-- End Row -->
                    </div>
                    <!-- End Body -->
                </div>
                <!-- End Card -->

                <!-- Modal History -->
                <div class="modal fade" id="history" tabindex="-1" role="dialog" aria-labelledby="historyTitle"
                     aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="historyTitle">Lịch Sử Đơn Hàng </h5>
                                <div class="trangThaiHeader ml-sm-1">
                                    <span th:class="${hoaDon.trangThai.toString() == 'ThanhCong' ? 'badge badge-soft-success' :
                      (hoaDon.trangThai.toString() == 'ChoGiao' ? 'badge badge-soft-warning' : 'badge badge-soft-danger')}" th:text="'Trạng thái: ' + ${hoaDon.trangThai}"></span>
                                </div>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <!-- Step -->
                                <ul class="step step-icon-xs" id="myHistory">
                                    <li class="step-item" th:each="lshd : ${lichSuHoaDonList}">
                                        <div class="step-content-wrapper">
                                            <span class="step-icon step-icon-soft-dark step-icon-pseudo"></span>

                                            <div class="step-content">
                                                <h5 class="mb-1">
                                                    <a class="text-dark" href="#" th:text="${lshd.hanhDong}"></a>
                                                </h5>

                                                <p class="font-size-sm mb-0" th:utext="'Thực hiện bởi: <h6>' + ${lshd.nguoiThucHien != null ? (lshd.nguoiThucHien.nhanVien != null ? lshd.nguoiThucHien.nhanVien.hoTen : (lshd.nguoiThucHien.khachHang != null ? lshd.nguoiThucHien.khachHang.hoTen : 'Anonymous')) : 'Anonymous'} +
                                                '</h6> Thời gian thực hiện: <h6>' + ${lshd.thoiGian} + '</h6>'"></p>
                                            </div>
                                        </div>
                                    </li>
                                    <!-- End Step Item -->
                                </ul>
                                <!-- End Step -->
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Modal History -->

                <!-- Modal Cancel Invoice-->
                <div class="modal fade" id="modalCancelReasons" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle" aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-sm" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="exampleModalCenterTitle">Lý do hủy đơn hàng</h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body" id="inputReason">
                                <textarea id="dataInputReason" style="border: 1px solid #e1e1e1;" rows="5" cols="44"></textarea>
                                <span id="notiInputReason" class="text-danger d-none">Không được để trống!</span>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-sm btn-secondary" data-dismiss="modal">Close</button>
                                <button id="huyFromDetail" type="button" class="btn btn-sm btn-danger d-none" data-dismiss="modal">
                                    <i class="tio-delete-outlined"></i> Hủy
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End Modal Cancel Invoice -->
            </div>

            <div class="col-lg-4">
                <!-- Card -->
                <div th:if="${hoaDon.khachHang != null}" class="card">
                    <!-- Header -->
                    <div class="card-header">
                        <h4 class="card-header-title">Khách hàng</h4>
                    </div>
                    <!-- End Header -->

                    <!-- Body -->
                    <div class="card-body">
                        <a class="media align-items-center"
                           th:href="@{|/cms/khach-hang/detail/${hoaDon.khachHang.id}|}">
                            <div class="avatar avatar-circle mr-3">
                                <img class="avatar-img" src="/assets/cms/img/160x160/img10.jpg" alt="Image Description">
                            </div>
                            <div class="media-body">
                                <span id="" class="customerName text-body d-inline-block text-hover-primary" th:text="${hoaDon.khachHang.hoTen}"></span>
                            </div>
                            <div class="media-body text-right">
                                <i class="tio-chevron-right text-body"></i>
                            </div>
                        </a>

                        <hr>

                        <a class="media align-items-center" href="/cms/customer-detail">
                            <div class="icon icon-soft-info icon-circle mr-3">
                                <i class="tio-shopping-basket-outlined"></i>
                            </div>
                            <div class="media-body">
                                <span class="text-body text-hover-primary"
                                      th:text="${countHoaDonCuaKhachHang} + ' đơn đã mua'"></span>
                            </div>
                            <div class="media-body text-right">
                                <i class="tio-chevron-right text-body"></i>
                            </div>
                        </a>

                        <hr>

                        <div class="d-flex justify-content-between align-items-center">
                            <h5>Thông tin liên hệ</h5>
                            <a class="link" href="javascript:;">Chỉnh sửa</a>
                        </div>

                        <ul class="list-unstyled list-unstyled-py-2">
                            <li class="customerPhone" th:text="${hoaDon.khachHang.sdt}">
                                <i class="tio-online mr-2"></i>
                            </li>
                        </ul>

                        <hr>

                        <div class="d-flex justify-content-between align-items-center">
                            <h5>Địa chỉ mặc định</h5>
                            <a class="link" href="javascript:;">Chỉnh sửa</a>
                        </div>

                        <span th:if="${hoaDon.khachHang!= null && hoaDon.khachHang.diaChiMacDinh != null}" class="customerAddress d-block"
                              th:utext="${hoaDon.khachHang.diaChiMacDinh.soNha} + ', <br>' +
                      ${hoaDon.khachHang.diaChiMacDinh.phuongXa} + ', <br>' +
                      ${hoaDon.khachHang.diaChiMacDinh.quanHuyen} + ', <br>' +
                      ${hoaDon.khachHang.diaChiMacDinh.tinhThanhPho}">
                   <img class="avatar avatar-xss avatar-circle ml-1"
                        src="/assets/cms/vendor/flag-icon-css/flags/1x1/gb.svg" alt="Great Britain Flag">
                </span>

                        <hr>

                        <div class="d-flex justify-content-between align-items-center">
                            <h5>Địa chỉ giao hàng</h5>
                            <a class="link" href="javascript:;">Chỉnh sửa</a>
                        </div>

                        <span class="d-block"
                              th:utext="${hoaDon.diaChiNhan != null ? hoaDon.diaChiNhan : ''}">
                   <img class="avatar avatar-xss avatar-circle ml-1"
                        src="/assets/cms/vendor/flag-icon-css/flags/1x1/gb.svg" alt="Great Britain Flag">
                </span>
                    </div>
                    <!-- End Body -->
                </div>
                <div th:if="${hoaDon.khachHang == null}" class="card">
                    <div class="card-header">
                        <h4>Thông tin người nhận</h4>
                    </div>
                    <div class="card-body">
                        <div class="">
                            <p>Tên: <span class="customerName" th:text="${hoaDon.tenNguoiNhan}"></span></p>
                        </div>
                        <div class="">
                            <p>Sdt: <span class="customerPhone" th:text="${hoaDon.sdtNhan}"></span></p>
                        </div>
                        <div class="">
                            <p>Địa chỉ: <span class="customerAddress" th:text="${hoaDon.diaChiNhan}"></span></p>
                        </div>
                    </div>
                </div>
                <!-- End Card -->
            </div>
        </div>
        <!-- End Row -->
    </div>
    <!-- End Content -->

    <!-- Footer -->
    <div class="d-print-none">

        <div class="footer">
            <div class="row justify-content-between align-items-center">
                <div class="col">
                    <p class="font-size-sm mb-0">&copy; Front. <span
                            class="d-none d-sm-inline-block">2020 Htmlstream.</span></p>
                </div>
                <div class="col-auto">
                    <div class="d-flex justify-content-end">
                        <!-- List Dot -->
                        <ul class="list-inline list-separator">
                            <li class="list-inline-item">
                                <a class="list-separator-link" href="#">FAQ</a>
                            </li>

                            <li class="list-inline-item">
                                <a class="list-separator-link" href="#">License</a>
                            </li>

                            <li class="list-inline-item">
                                <!-- Keyboard Shortcuts Toggle -->
                                <div class="hs-unfold">
                                    <a class="js-hs-unfold-invoker btn btn-icon btn-ghost-secondary rounded-circle"
                                       href="javascript:;" data-hs-unfold-options='{
                                "target": "#keyboardShortcutsSidebar",
                                "type": "css-animation",
                                "animationIn": "fadeInRight",
                                "animationOut": "fadeOutRight",
                                "hasOverlay": true,
                                "smartPositionOff": true
                               }'>
                                        <i class="tio-command-key"></i>
                                    </a>
                                </div>
                                <!-- End Keyboard Shortcuts Toggle -->
                            </li>
                        </ul>
                        <!-- End List Dot -->
                    </div>
                </div>
            </div>
        </div>


    </div>
    <!-- End Footer -->
</main>
<!-- ========== END MAIN CONTENT ========== -->

<!-- ========== SECONDARY CONTENTS ========== -->
<!-- Keyboard Shortcuts -->
<div id="keyboardShortcutsSidebar" class="hs-unfold-content sidebar sidebar-bordered sidebar-box-shadow">
    <div class="card card-lg sidebar-card">
        <div class="card-header">
            <h4 class="card-header-title">Keyboard shortcuts</h4>

            <!-- Toggle Button -->
            <a class="js-hs-unfold-invoker btn btn-icon btn-xs btn-ghost-dark ml-2" href="javascript:;"
               data-hs-unfold-options='{
                "target": "#keyboardShortcutsSidebar",
                "type": "css-animation",
                "animationIn": "fadeInRight",
                "animationOut": "fadeOutRight",
                "hasOverlay": true,
                "smartPositionOff": true
               }'>
                <i class="tio-clear tio-lg"></i>
            </a>
            <!-- End Toggle Button -->
        </div>

        <!-- Body -->
        <div class="card-body sidebar-body sidebar-scrollbar">
            <div class="list-group list-group-sm list-group-flush list-group-no-gutters mb-5">
                <div class="list-group-item">
                    <h5 class="mb-1">Formatting</h5>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span class="font-weight-bold">Bold</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">b</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <em>italic</em>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">i</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <u>Underline</u>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">u</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <s>Strikethrough</s>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">Alt</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">s</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span class="small">Small text</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">s</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <mark>Highlight</mark>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">e</kbd>
                        </div>
                    </div>
                </div>
            </div>

            <div class="list-group list-group-sm list-group-flush list-group-no-gutters mb-5">
                <div class="list-group-item">
                    <h5 class="mb-1">Insert</h5>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Mention person <a href="#">(@Brian)</a></span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">@</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Link to doc <a href="#">(+Meeting notes)</a></span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">+</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <a href="#">#hashtag</a>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">#hashtag</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Date</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">/date</kbd>
                            <kbd class="d-inline-block mb-1">Space</kbd>
                            <kbd class="d-inline-block mb-1">/datetime</kbd>
                            <kbd class="d-inline-block mb-1">/datetime</kbd>
                            <kbd class="d-inline-block mb-1">Space</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Time</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">/time</kbd>
                            <kbd class="d-inline-block mb-1">Space</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Note box</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">/note</kbd>
                            <kbd class="d-inline-block mb-1">Enter</kbd>
                            <kbd class="d-inline-block mb-1">/note red</kbd>
                            <kbd class="d-inline-block mb-1">/note red</kbd>
                            <kbd class="d-inline-block mb-1">Enter</kbd>
                        </div>
                    </div>
                </div>
            </div>

            <div class="list-group list-group-sm list-group-flush list-group-no-gutters mb-5">
                <div class="list-group-item">
                    <h5 class="mb-1">Editing</h5>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Find and replace</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">r</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Find next</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">n</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Find previous</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">p</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Indent</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Tab</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Un-indent</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Shift</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">Tab</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Move line up</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">Shift</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1"><i class="tio-arrow-large-upward-outlined"></i></kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Move line down</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">Shift</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1"><i
                                class="tio-arrow-large-downward-outlined font-size-sm"></i></kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Add a comment</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">Alt</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">m</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Undo</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">z</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Redo</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">y</kbd>
                        </div>
                    </div>
                </div>
            </div>

            <div class="list-group list-group-sm list-group-flush list-group-no-gutters">
                <div class="list-group-item">
                    <h5 class="mb-1">Application</h5>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Create new doc</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">Alt</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">n</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Present</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">Shift</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">p</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Share</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">Shift</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">s</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Search docs</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">Shift</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">o</kbd>
                        </div>
                    </div>
                </div>
                <div class="list-group-item">
                    <div class="row align-items-center">
                        <div class="col-5">
                            <span>Keyboard shortcuts</span>
                        </div>
                        <div class="col-7 text-right">
                            <kbd class="d-inline-block mb-1">Ctrl</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">Shift</kbd> <small class="text-muted">+</small> <kbd
                                class="d-inline-block mb-1">/</kbd>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End Body -->
    </div>
</div>
<!-- End Keyboard Shortcuts -->

<!-- Export Orders Modal -->
<div class="modal fade" id="exportOrdersModal" tabindex="-1" role="dialog" aria-labelledby="exportOrdersModalTitle"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
            <!-- Header -->
            <div class="modal-header">
                <h4 id="exportOrdersModalTitle" class="modal-title">Export orders</h4>

                <button type="button" class="btn btn-icon btn-sm btn-ghost-secondary" data-dismiss="modal"
                        aria-label="Close">
                    <i class="tio-clear tio-lg"></i>
                </button>
            </div>
            <!-- End Header -->

            <!-- Body -->
            <div class="modal-body">
                <!-- Form Group -->
                <div class="form-group">
                    <!-- Custom Checkbox -->
                    <div class="custom-control custom-radio mb-2">
                        <input type="radio" id="ordersRadio1" name="ordersRadio" class="custom-control-input"
                               checked="">
                        <label class="custom-control-label" for="ordersRadio1">Current page</label>
                    </div>
                    <div class="custom-control custom-radio mb-2">
                        <input type="radio" id="ordersRadio2" name="ordersRadio" class="custom-control-input">
                        <label class="custom-control-label" for="ordersRadio2">All orders</label>
                    </div>
                    <div class="custom-control custom-radio mb-2">
                        <input type="radio" id="ordersRadio3" name="ordersRadio" class="custom-control-input"
                               disabled="">
                        <label class="custom-control-label" for="ordersRadio3">Selected: 20 orders</label>
                    </div>
                    <div class="custom-control custom-radio">
                        <input type="radio" id="ordersRadio4" name="ordersRadio" class="custom-control-input">
                        <label class="custom-control-label" for="ordersRadio4">Order by date</label>
                    </div>
                    <!-- End Custom Checkbox -->
                </div>
                <!-- End Form Group -->

                <label class="input-label">Export as</label>

                <!-- Custom Checkbox -->
                <div class="custom-control custom-radio mb-2">
                    <input type="radio" id="orderAsRadio1" name="orderAsRadio" class="custom-control-input" checked="">
                    <label class="custom-control-label" for="orderAsRadio1">CSV for Excel, Numbers, or other spreadsheet
                        programs</label>
                </div>
                <div class="custom-control custom-radio">
                    <input type="radio" id="orderAsRadio2" name="orderAsRadio" class="custom-control-input">
                    <label class="custom-control-label" for="orderAsRadio2">Plain CSV file</label>
                </div>
                <!-- End Custom Checkbox -->
            </div>
            <!-- End Body -->

            <!-- Footer -->
            <div class="modal-footer">
                <button type="button" class="btn btn-white mr-2" data-dismiss="modal" aria-label="Close">Cancel</button>
                <button type="button" class="btn btn-primary">Export orders</button>
            </div>
            <!-- End Footer -->
        </div>
    </div>
</div>
<iframe id="myPrintInvoice" class="d-none"></iframe>
<!-- End Export Orders Modal -->
<!-- ========== END SECONDARY CONTENTS ========== -->


<!-- JS Implementing Plugins -->
<script src="/assets/cms/js/vendor.min.js"></script>


<!-- JS Front -->
<script src="/assets/cms/js/theme.min.js"></script>

<!-- JS Plugins Init. -->
<script>
    $(document).on('ready', function () {
        // ONLY DEV
        // =======================================================

        if (window.localStorage.getItem('hs-builder-popover') === null) {
            $('#builderPopover').popover('show')
                .on('shown.bs.popover', function () {
                    $('.popover').last().addClass('popover-dark')
                });

            $(document).on('click', '#closeBuilderPopover', function () {
                window.localStorage.setItem('hs-builder-popover', true);
                $('#builderPopover').popover('dispose');
            });
        } else {
            $('#builderPopover').on('show.bs.popover', function () {
                return false
            });
        }

        // END ONLY DEV
        // =======================================================


        // BUILDER TOGGLE INVOKER
        // =======================================================
        $('.js-navbar-vertical-aside-toggle-invoker').click(function () {
            $('.js-navbar-vertical-aside-toggle-invoker i').tooltip('hide');
        });


        // INITIALIZATION OF MEGA MENU
        // =======================================================
        var megaMenu = new HSMegaMenu($('.js-mega-menu'), {
            desktop: {
                position: 'left'
            }
        }).init();


        // INITIALIZATION OF NAVBAR VERTICAL NAVIGATION
        // =======================================================
        var sidebar = $('.js-navbar-vertical-aside');
        sidebar.hsSideNav({
            mobileOverlayClass: 'd-print-none'
        });

        $('.js-navbar-vertical-aside').addClass('d-print-none');


        // INITIALIZATION OF TOOLTIP IN NAVBAR VERTICAL MENU
        // =======================================================
        $('.js-nav-tooltip-link').tooltip({boundary: 'window'})

        $(".js-nav-tooltip-link").on("show.bs.tooltip", function (e) {
            if (!$("body").hasClass("navbar-vertical-aside-mini-mode")) {
                return false;
            }
        });


        // INITIALIZATION OF UNFOLD
        // =======================================================
        $('.js-hs-unfold-invoker').each(function () {
            var unfold = new HSUnfold($(this)).init();
        });


        // INITIALIZATION OF FORM SEARCH
        // =======================================================
        $('.js-form-search').each(function () {
            new HSFormSearch($(this)).init()
        });
    });

    $(document).on('ready', function () {

        function Toast(status, message) {
            const Toast = Swal.mixin({
                toast: true,
                position: "top-end",
                showConfirmButton: false,
                timer: 3000,
                timerProgressBar: true,
                didOpen: (toast) => {
                    toast.onmouseenter = Swal.stopTimer;
                    toast.onmouseleave = Swal.resumeTimer;
                },
                customClass: {
                    popup: 'custom-toast-class', // Thêm lớp CSS tùy chỉnh
                }
            });
            Toast.fire({
                icon: status,
                title: message
            });
        }

        function ToastSuccess(message) {
            Toast('success', message)
        }

        function ToastError(message) {
            Toast('error', message)
        }

        // print
        function printTimeline(status, type) {
            let ul = $('#myTimeline');
            let li = document.createElement('li');
            li.className = 'timeline-item';
            let html = `<div class="timeline-badge ${type}"><i class="tio-checkmark-square-outlined"></i></div>
                        <div class="timeline-panel">
                            <div class="timeline-heading">
                                <h4 class="timeline-title">${status}</h4>
                            </div>
                        </div>`;
            li.innerHTML = html;
            ul.append(li);
        }

        function printHistory(thoiGian, nguoiThucHien, hanhDong) {
            let ul = $('#myHistory');
            let li = document.createElement('li');
            li.className = 'step-item';
            let html = `<div class="step-content-wrapper">
                <span class="step-icon step-icon-soft-dark step-icon-pseudo"></span>
                <div class="step-content">
                    <h5 class="mb-1">
                        <a class="text-dark" href="#">${hanhDong}</a>
                    </h5>
                    <p class="font-size-sm mb-0">Thực hiện bởi: <h6>${nguoiThucHien}</h6> Thời gian thực hiện: <h6>${thoiGian}</h6></p>
                </div>
            </div>`;
            li.innerHTML = html;
            ul.append(li);
        }

        function printStatusHeader(typeOfColor, status) {
            let div = $('.trangThaiHeader');
            let html = `<span class="badge badge-soft-${typeOfColor}">Trạng Thái: ${status}
                  <span class="legend-indicator bg-${typeOfColor}"></span>
                </span>`;
            div.html('');
            div.append(html);
        }

        // handle timeline
        $('#xacNhanFromDetail').on('click', function () {
            var idHoaDon = String($(this).closest("div").attr("id-hoa-don"));
            console.log(idHoaDon);
            Swal.fire({
                title: "Bạn chắc chứ?",
                text: "Bạn đang xác nhận đơn hàng!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                cancelButtonText: "Hủy",
                confirmButtonText: "Xác Nhận"
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: "POST",
                        url: "/api/hoa-don/xac-nhan-detail",
                        contentType: "application/json",
                        data: JSON.stringify(idHoaDon),
                        success: function (response) {
                            console.log(response);
                            ToastSuccess('Xác nhận đơn hàng thành công');
                            let type = 'success';
                            let status = response.trangThaiSauUpdate;
                            let typeOfColor = 'success';
                            if(status != 'ChoXacNhan' && status != 'Huy') {
                                $('printOrder').removeClass('d-none');
                            } else {
                                $('printOrder').addClass('d-none');
                            }
                            if (status == 'Huy') {
                                type = 'danger';
                                typeOfColor = 'danger';
                                $('#xacNhanFromDetail').hide();
                                $('#getAttrToHuyFromDetail').hide();
                                $('#printOrder').removeClass('d-none');
                            } else if (status == 'ChoXacNhan') {
                                typeOfColor = 'danger';
                            } else if (status == 'ChoGiao') {
                                typeOfColor = 'warning';
                                $('#getAttrToHuyFromDetail').addClass('d-none');
                                $('#hoanTacFromDetail').removeClass('d-none');
                                $('#printOrder').removeClass('d-none');
                            } else if (status == 'ThanhCong') {
                                $('#xacNhanFromDetail').hide();
                                $('#getAttrToHuyFromDetail').hide();
                                $('#hoanTacFromDetail').hide();
                                $('#printOrder').removeClass('d-none');
                            }
                            printStatusHeader(typeOfColor, status);
                            printTimeline(status, type);
                            printHistory(response.thoiGian, response.nguoiThucHien, response.hanhDong);
                            console.log(response);
                        },
                        error: function (error) {
                            ToastError('Xác nhận đơn hàng thất bại');
                            console.error('Xảy ra lỗi: ', error);
                        }
                    });
                }
            });
        });

        $('#dataInputReason').on('input', function () {
            var dataInput = $(this).val().trim();
            if(dataInput == '') {
                $('#notiInputReason').removeClass('d-none');
                $('#huyFromDetail').addClass('d-none');
            } else {
                $('#notiInputReason').addClass('d-none');
                $('#huyFromDetail').removeClass('d-none');
            }
        })

        $('#huyFromDetail').on('click', function () {
            var idHoaDon = String($('#getAttrToHuyFromDetail').closest("div").attr("id-hoa-don"));
            $.ajax({
                type: "POST",
                url: "/api/hoa-don/huy-detail",
                contentType: "application/json",
                data: {
                    id:idHoaDon,
                    lydo:'Thích Thì Hủy'
                },
                success: function (response) {
                    console.log(response);
                    ToastSuccess('Hủy đơn hàng thành công');
                    let type = 'danger';
                    let status = 'Hủy';
                    let nguoiThucHien = response.nguoiThucHien;
                    let thoiGian = response.thoiGian;
                    let hanhDong = response.hanhDong;
                    $('#xacNhanFromDetail').hide();
                    $('#getAttrToHuyFromDetail').hide();
                    printStatusHeader(type, status);
                    printTimeline(status, type);
                    printHistory(thoiGian, nguoiThucHien, hanhDong);
                },
                error: function (error) {
                    ToastError('Xảy ra lỗi khi hủy đơn hàng, vui lòng thử lại!')
                    console.error('Xảy ra lỗi: ', error);
                }
            });
        })

        // reverse status
        $('#hoanTacFromDetail').on('click', function () {
            var idHoaDon = String($(this).closest("div").attr("id-hoa-don"));
            Swal.fire({
                title: "Bạn chắc chứ?",
                text: "Bạn đang hoàn tác đơn hàng!",
                icon: "warning",
                showCancelButton: true,
                confirmButtonColor: "#3085d6",
                cancelButtonColor: "#d33",
                cancelButtonText: "Hủy",
                confirmButtonText: "Xác Nhận"
            }).then((result) => {
                if (result.isConfirmed) {
                    $.ajax({
                        type: "POST",
                        url: "/api/hoa-don/hoan-tac-detail",
                        contentType: "application/json",
                        data: JSON.stringify(idHoaDon),
                        success: function (response) {
                            console.log(response);
                            ToastSuccess('Hoàn tác đơn hàng thành công');
                            $('#getAttrToHuyFromDetail').removeClass('d-none');
                            let type = 'success';
                            let status = response.trangThaiSauUpdate;
                            $('#hoanTacFromDetail').hide();
                            $('#printOrder').hide();
                            printStatusHeader(type, status);
                            printTimeline(status, type);
                            printHistory(response.thoiGian, response.nguoiThucHien, response.hanhDong);
                            console.log(response);
                        },
                        error: function (error) {
                            ToastError('Xảy ra lỗi khi hoàn tác đơn hàng, vui lòng thử lại!');
                            console.error('Xảy ra lỗi: ', error);
                        }
                    });
                }
            });
        })

        $('#printOrder').on('click', function () {
            var items = [];
            var codAmount = 0;
            var customerName = document.querySelector('.customerName').textContent;
            var customerPhone = document.querySelector('.customerPhone').textContent;
            var customerAddress = document.querySelector('.customerAddress').textContent;
            console.log(customerName + " - " + customerPhone + " - " + customerAddress);
            var productElements = document.querySelectorAll('.product');
            productElements.forEach(function (productElement) {
                var productName = productElement.querySelector('.productName').textContent;
                var productColor = productElement.querySelector('.productColor').textContent;
                var productSize = productElement.querySelector('.productSize').textContent;
                var productPrice = productElement.querySelector('.productPrice').textContent.replace(/[,.]/g, '');
                var productQuantity = productElement.querySelector('.productQuantity').textContent;

                codAmount += (parseFloat(productPrice) * productQuantity);
                productName = productName + ", " + productColor + ", size " + productSize;

                var gItem = {
                    name: productName,
                    code: "Giày",
                    quantity: parseInt(productQuantity),
                    price: parseInt(productPrice),
                    length: 12,
                    width: 12,
                    height: 12,
                    weight: 1200,
                    category: {
                        level2: "Giày"
                    }
                }
                items.push(gItem);
            })
            console.log(codAmount);

            $.ajax({
                type: "POST",
                url: "https://dev-online-gateway.ghn.vn/shiip/public-api/v2/shipping-order/create",
                contentType: "application/json",
                headers: {
                    "Token": "68b8b44f-a88d-11ee-8bfa-8a2dda8ec551"
                },
                data: JSON.stringify(
                    {
                        shop_id: "190713",
                        from_name: "LightBee Shop",
                        from_phone: "0359966461",
                        from_address: "Trường Cao Đẳng FPT Polytechnic",
                        from_ward_name: "Phường Xuân Phương",
                        from_district_name: "Nam Từ Liêm",
                        from_province_name: "Hà Nội",
                        to_name: customerName,
                        to_phone: customerPhone,
                        to_address: customerAddress,
                        to_ward_code: "250318",
                        to_district_id: 3323,
                        service_id: 5,
                        service_type_id: 2,
                        payment_type_id: 2,
                        cod_amount: parseInt(codAmount),
                        required_note: "CHOXEMHANGKHONGTHU",
                        items: items,
                        weight: 2000,
                        length: 1,
                        width: 19,
                        height: 10
                    }
                ),
                success: function (responseFirst) {
                    console.log(responseFirst);
                    $.ajax({
                        type: "POST",
                        url: "https://dev-online-gateway.ghn.vn/shiip/public-api/v2/a5/gen-token",
                        contentType: "application/json",
                        headers: {
                            "Token": "68b8b44f-a88d-11ee-8bfa-8a2dda8ec551"
                        },
                        data: JSON.stringify(
                            {
                                "order_codes": [responseFirst.data.order_code]
                            }
                        ),
                        success: function (responseSecond) {

                            console.log(responseSecond);
                            var token = responseSecond.data.token;
                            $.ajax({
                                type: "GET",
                                url: "/api/hoa-don/printOrder?token=" + token,
                                contentType: "application/json",
                                success: function (responseThird) {
                                    console.log(responseThird);
                                    printHTML(responseThird);
                                },
                                error: function (error) {
                                    console.error('Xảy ra lỗi: ', error);
                                }
                            })
                        },
                        error: function (error) {
                            console.error('Xảy ra lỗi: ', error);
                        }
                    })
                },
                error: function (error) {
                    console.error('Xảy ra lỗi: ', error);
                }
            })
        })

        function printHTML(htmlContent) {
            // Tạo một cửa sổ mới hoặc một tab mới
            var newWindow = window.open("", "_blank");

            // Kiểm tra xem cửa sổ đã được tạo thành công chưa
            if (newWindow) {
                // Chèn nội dung HTML vào cửa sổ mới
                newWindow.document.write(htmlContent);
                // Đóng luôn trong trường hợp nội dung rỗng
                newWindow.document.close();
            } else {
                // Nếu không tạo được cửa sổ mới, thông báo lỗi
                alert("Không thể mở cửa sổ mới.");
            }
        }

    });
</script>
<script src="/assets/cms/js/sweetalert2.all.min.js"></script>
<!-- IE Support -->
<div th:replace="~{/cms/pages/_IE-suport.html}"></div>
</body>
</html>
